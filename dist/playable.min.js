var playable=function(t){"use strict";var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function o(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var f=function(){function t(t){this.type=null,this.type=t}return t.ADDED="added",t.REMOVED="removed",t.ADDED_TO_STAGE="addToStage",t.REMOVED_FROM_STAGE="removeFromStage",t.ENTER_FRAME="enterFrame",t.TICK="tick",t.TICKER_PAUSE="tickerPause",t.TICKER_RESUME="tickerResume",t.VIEWPORT_RESIZE="viewportResize",t.PROGRESS="progress",t.COMPLETE="complete",t.LOAD="load",t.ERROR="error",t.SOUND_COMPLETE="soundComplete",t}(),e=function(){function t(){this.$events={}}return t.prototype.on=function(t,e){var i=this.$events[t]||[];return i.push(e),this.$events[t]=i,this},t.prototype.off=function(t,e){var i=this.$events[t]||[];if(e){var n=i.indexOf(e);0<=n&&i.splice(n,1)}else i.length=0;return this},t.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=this.$events[t];if(n&&n.length){for(var r=0,o=n;r<o.length;r++){o[r].apply(this,e)}return!0}return!1},t.prototype.hasEventListener=function(t){var e=this.$events[t];return e&&0<e.length},t.prototype.removeAllListeners=function(){return this.$events={},this},t}(),i=function(i){function t(t){var e=i.call(this)||this;return e.$fps=0,e.$stage=null,e.$paused=!1,e.$shouldResume=!1,e.$timerIndex=0,e.$lastTimestamp=0,e.$tickHandle=null,e.$stage=t,e.$timers=[],e.$boundTick=e.$tick.bind(e),e.$enterFrameCallbackList=[t],e.$start(),e}return o(t,i),Object.defineProperty(t.prototype,"fps",{get:function(){return this.$fps},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this.$paused},enumerable:!0,configurable:!0}),t.prototype.$start=function(){for(var i=this,t=["","o","ms","moz","webkit"],e=0,n=t;e<n.length;e++){var r=(c=n[e])?c+"RequestAnimationFrame":"requestAnimationFrame",o=c?c+"CancelAnimationFrame":"cancelAnimationFrame",s=c?c+"CancelRequestAnimationFrame":"cancelRequestAnimationFrame";window.requestAnimationFrame=window.requestAnimationFrame||window[r],window.cancelAnimationFrame=window.cancelAnimationFrame||window[o],window.cancelAnimationFrame=window.cancelAnimationFrame||window[s]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t){return window.setTimeout(t,1e3/60)},window.cancelAnimationFrame=function(t){window.clearTimeout(t)});for(var h=function(t){var e=t?t+"Hidden":"hidden";if(void 0===document[e])return"break";document.addEventListener(t+"visibilitychange",function(){var t=i.$paused;document[e]&&!t?(i.pause(),i.$shouldResume=!0):i.$shouldResume&&(i.resume(),i.$shouldResume=!1)})},a=0,u=t;a<u.length;a++){var c;if("break"===h(c=u[a]))break}return this.$tick(),this},t.prototype.pause=function(){return this.$paused||(this.$paused=!0,this.$lastTimestamp=0,this.emit(f.TICKER_PAUSE),cancelAnimationFrame(this.$tickHandle)),this},t.prototype.resume=function(){return this.$paused&&(this.$paused=!1,this.$tick(),this.emit(f.TICKER_RESUME)),this},t.prototype.setTimeout=function(t,e){void 0===e&&(e=0);var i=++this.$timerIndex;return this.$timers[i]={handler:t,timeout:e,resetTime:e},i},t.prototype.clearTimeout=function(t){delete this.$timers[t]},t.prototype.setInterval=function(t,e){var i=++this.$timerIndex;return this.$timers[i]={handler:t,timeout:e,resetTime:e,interval:!0},i},t.prototype.clearInterval=function(t){delete this.$timers[t]},t.prototype.registerEnterFrameCallback=function(t){var e=this.$enterFrameCallbackList;return e.indexOf(t)<0&&e.push(t),this},t.prototype.unregisterEnterFrameCallback=function(t){var e=this.$enterFrameCallbackList,i=e.indexOf(t);return 0<=i&&e.splice(i,1),this},t.prototype.$tick=function(){for(var t=this.$lastTimestamp?Date.now()-this.$lastTimestamp:1e3/60,e=0,i=this.$enterFrameCallbackList;e<i.length;e++){i[e].emit(f.ENTER_FRAME,t)}this.$fps=Math.round(1e3/t),this.emit(f.TICK,t),this.$checkTimers(t),this.$lastTimestamp=Date.now(),this.$tickHandle=requestAnimationFrame(this.$boundTick)},t.prototype.$checkTimers=function(t){var e=this.$timers;for(var i in e){var n=e[i];(n.resetTime=n.resetTime-t)<=0&&(n.handler(),n.interval?n.resetTime+=n.timeout:this.clearTimeout(+i))}},t}(e),$=function(){function n(t,e){this.set(t,e)}return Object.defineProperty(n.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),n.prototype.set=function(t,e){return this.x=t||0,this.y=e||0,this},n.prototype.add=function(t,e){return t instanceof n?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=e),this},n.prototype.subtract=function(t,e){return t instanceof n?(this.x-=t.x,this.y-=t.y):(this.x-=t,this.y-=e),this},n.prototype.divide=function(t,e){return t instanceof n?(this.x/=t.x,this.y/=t.y):(this.x/=t,this.y/=e),this},n.prototype.dotProduct=function(t,e){return t instanceof n?this.x*t.x+this.y*t.y:this.x*t+this.y*e},n.prototype.normalize=function(){var t=this.length;return this.x=this.x/t,this.y=this.y/t,this},n.prototype.negate=function(){return this.x*=-1,this.y*=-1,this},n.prototype.scale=function(t,e){return this.x*=t,this.y*=void 0===e?t:e,this},n.prototype.rotate=function(t){var e=this.x,i=this.y;return this.x=e*Math.cos(t)-i*Math.sin(t),this.y=e*Math.sin(t)+i*Math.cos(t),this},n.prototype.angle=function(){return Math.atan2(this.y,this.x)},n.prototype.distance=function(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))},n.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},n.prototype.transform=function(t){var e=this.x,i=this.y;return this.x=t.a*e+t.c*i+t.tx,this.y=t.b*e+t.d*i+t.ty,this},n.prototype.release=function(){return n.recycle(this),this},n.create=function(t,e){var i=this.$pool;return 0<i.length?i.pop().set(t,e):new n(t,e)},n.recycle=function(t){this.$pool.push(t)},n.$pool=[],n}(),r=function(){function p(t,e,i,n,r,o){0<arguments.length?this.set(t,e,i,n,r,o):this.identity()}return p.prototype.set=function(t,e,i,n,r,o){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=o,this},p.prototype.identity=function(){return this.set(1,0,0,1,0,0)},p.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,o=this.ty,s=t*n-i*e;return this.a=n/s,this.b=-e/s,this.c=-i/s,this.d=t/s,this.tx=(i*o-n*r)/s,this.ty=(e*r-t*o)/s,this},p.prototype.prepend=function(t,e,i,n,r,o){if(t instanceof p)return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty);var s=this.a,h=this.b,a=this.c,u=this.d,c=this.tx,l=this.ty;return this.a=t*s+e*a,this.b=t*h+e*u,this.c=i*s+n*a,this.d=i*h+n*u,this.tx=r*s+o*a+c,this.ty=r*h+o*u+l,this},p.prototype.append=function(t,e,i,n,r,o){if(t instanceof p)return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty);var s=this.a,h=this.b,a=this.c,u=this.d,c=this.tx,l=this.ty;return this.a=t*s+i*h,this.b=e*s+n*h,this.c=t*a+i*u,this.d=e*a+n*u,this.tx=t*c+i*l+r,this.ty=e*c+n*l+o,this},p.prototype.multiply=function(t){var e=this.a*t.x+this.c*t.y+this.tx,i=this.b*t.x+this.d*t.y+this.ty;return $.create(e,i)},p.prototype.scale=function(t,e){return this.append(t,0,0,void 0===e?t:e,0,0)},p.prototype.rotate=function(t){var e=Math.sin(t),i=Math.cos(t);return this.append(i,e,-e,i,0,0)},p.prototype.skew=function(t,e){return this.append(1,Math.tan(e),Math.tan(t),1,0,0)},p.prototype.translate=function(t,e){return t instanceof $?this.append(1,0,0,1,t.x,t.y):this.append(1,0,0,1,t,e)},p.prototype.equals=function(t){return t instanceof p&&this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.tx===t.tx&&this.ty===t.ty},p.prototype.release=function(){p.recycle(this)},p.create=function(t,e,i,n,r,o){var s,h=this.$pool;return s=0<h.length?h.pop():new p,arguments.length?s.set(t,e,i,n,r,o):s.identity(),s},p.recycle=function(t){this.$pool.push(t)},p.$pool=[],p}(),d=function(){function o(t,e,i,n){this.set(t,e,i,n)}return o.prototype.set=function(t,e,i,n){return this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0,this},Object.defineProperty(o.prototype,"top",{get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){this.height=t-this.y},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"left",{get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"right",{get:function(){return this.x+this.width},set:function(t){this.width=t-this.x},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"topLeft",{get:function(){return $.create(this.left,this.top)},set:function(t){this.top=t.y,this.left=t.x},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"bottomRight",{get:function(){return $.create(this.right,this.bottom)},set:function(t){this.bottom=t.y,this.right=t.x},enumerable:!0,configurable:!0}),o.prototype.contains=function(t,e){return t>=this.x&&t<=this.x+this.width&&e<=this.y&&e<=this.y+this.height},o.prototype.release=function(){o.recycle(this)},o.create=function(t,e,i,n){var r=this.$pool;return 0<r.length?r.pop().set(t,e,i,n):new o(t,e,i,n)},o.recycle=function(t){this.$pool.push(t)},o.$pool=[],o}(),c=function(i){function n(t){var e=i.call(this,t)||this;return e.$init(t),e}return o(n,i),n.prototype.$init=function(t){return this.type=t,this.targetX=0,this.targetY=0,this.stageX=0,this.stageY=0,this.identifier=0,this.target=null,this.currentTarget=null,this.propagationStopped=!1,this},n.prototype.stopPropagation=function(){this.propagationStopped=!0},n.prototype.release=function(){n.recycle(this)},n.create=function(t){var e=this.$pool;return 0<e.length?e.pop().$init(t):new n(t)},n.recycle=function(t){this.$pool.push(t)},n.TOUCH_START="touchStart",n.TOUCH_MOVE="touchMove",n.TOUCH_END="touchEnd",n.TOUCH_CANCEL="touchCancel",n.TOUCH_TAP="touchTap",n.$pool=[],n}(f),w=function(i){function g(){var t=i.call(this)||this;return t.name="",t.tag="",t.touchable=!0,t.$x=0,t.$y=0,t.$width=0,t.$height=0,t.$anchorX=0,t.$anchorY=0,t.$skewX=0,t.$skewY=0,t.$scaleX=1,t.$scaleY=1,t.$rotation=0,t.$alpha=1,t.$visible=!0,t.$backgroundColor=null,t.$backgroundImage=null,t.$backgroundPattern=null,t.$backgroundFillMode="scale",t.$dirty=!0,t.$stage=null,t.$parent=null,t.$children=[],t.$touches=[],t.$canvas=document.createElement("canvas"),t.$context=t.$canvas.getContext("2d"),t.on(f.ADDED,t.$onAdded),t.on(f.REMOVED,t.$onRemoved),t.on(f.ADDED_TO_STAGE,t.$onAddedToStage),t.on(f.REMOVED_FROM_STAGE,t.$onRemovedFromStage),t}return o(g,i),Object.defineProperty(g.prototype,"width",{get:function(){return this.$width?this.$width:this.$canvas.width/g.pixelRatio},set:function(t){this.$width!==t&&(this.$width=t,this.$resizeCanvas())},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"height",{get:function(){return this.$height?this.$height:this.$canvas.height/g.pixelRatio},set:function(t){this.$height!==t&&(this.$height=t,this.$resizeCanvas())},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"x",{get:function(){return this.$x},set:function(t){this.$x!==t&&(this.$x=t,this.$markParentDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"y",{get:function(){return this.$y},set:function(t){this.$y!==t&&(this.$y=t,this.$markParentDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"anchorX",{get:function(){return this.$anchorX},set:function(t){this.$anchorX!==t&&(this.$anchorX=t,this.$markDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"anchorY",{get:function(){return this.$anchorY},set:function(t){this.$anchorY!==t&&(this.$anchorY=t,this.$markDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"skewX",{get:function(){return this.$skewX},set:function(t){this.$skewX!==t&&(this.$skewX=t,this.$markParentDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"skewY",{get:function(){return this.$skewY},set:function(t){this.$skewY!==t&&(this.$skewY=t,this.$markParentDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"scaleX",{get:function(){return this.$scaleX},set:function(t){this.$scaleX!==t&&(this.$scaleX=t,this.$markParentDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"scaleY",{get:function(){return this.$scaleY},set:function(t){this.$scaleY!==t&&(this.$scaleY=t,this.$markParentDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"rotation",{get:function(){return this.$rotation},set:function(t){this.$rotation!==t&&(this.$rotation=t,this.$markParentDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"alpha",{get:function(){return this.$alpha},set:function(t){this.$alpha!==t&&(this.$alpha=t,this.$markParentDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"backgroundColor",{get:function(){return this.$backgroundColor},set:function(t){this.$backgroundColor!==t&&(this.$backgroundColor=t,this.$markDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"backgroundImage",{get:function(){return this.$backgroundImage},set:function(t){this.$backgroundImage!==t&&(this.$backgroundImage=t,this.$backgroundPattern=this.$getPattern(this.$backgroundImage,this.$backgroundFillMode),this.$markDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"backgroundFillMode",{get:function(){return this.$backgroundFillMode},set:function(t){this.$backgroundFillMode!==t&&(this.$backgroundFillMode=t||"scale",this.$backgroundPattern=this.$getPattern(this.$backgroundImage,this.$backgroundFillMode),this.$markDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"visible",{get:function(){return this.$visible},set:function(t){this.$visible!==t&&(this.$visible=t,this.$markParentDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"dirty",{get:function(){return this.$dirty},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"stage",{get:function(){return this.$stage},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"parent",{get:function(){return this.$parent},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"children",{get:function(){return this.$children},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"ticker",{get:function(){return this.$stage?this.$stage.ticker:null},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"canvas",{get:function(){return this.$canvas},enumerable:!0,configurable:!0}),g.prototype.addChild=function(t){return this.addChildAt(t,this.$children.length)},g.prototype.addChildAt=function(t,e){return t.$parent&&t.$parent.removeChild(t),this.$stage&&t.emit(f.ADDED_TO_STAGE,this.$stage),t.emit(f.ADDED,this),this.$children.splice(e,0,t),this.$resizeCanvas(),this},g.prototype.replaceChild=function(t,e){var i=this.getChildIndex(t);return 0<=i&&(this.$children[i]=e,t.emit(f.REMOVED,this),this.$stage&&t.emit(f.REMOVED_FROM_STAGE,this.$stage)),this},g.prototype.getChildByName=function(t){for(var e=0,i=this.$children;e<i.length;e++){var n=i[e];if(n.name===t)return n}return null},g.prototype.getChildrenByTag=function(t){for(var e=[],i=0,n=this.$children;i<n.length;i++){var r=n[i];r.tag===t&&e.push(r)}return e},g.prototype.getChildAt=function(t){return this.$children[t]||null},g.prototype.getChildIndex=function(t){return this.$children.indexOf(t)},g.prototype.hasChild=function(t){return 0<=this.getChildIndex(t)},g.prototype.swapChildren=function(t,e){var i=this.getChildIndex(t),n=this.getChildIndex(e);return 0<=i&&0<=n&&this.swapChildrenAt(i,n),this},g.prototype.swapChildrenAt=function(t,e){if(t!==e){var i=this.$children[t],n=this.$children[e];i&&n&&(this.$children[t]=n,this.$children[e]=i,this.$markDirty())}return this},g.prototype.setChildIndex=function(t,e){var i=this.$children,n=this.getChildIndex(t);if(0<=n&&n<e){for(var r=n+1;r<=e;++r)i[r-1]=i[r];i[e]=t,this.$markDirty()}else if(0<=n&&e<n){for(r=n-1;e<=r;--r)i[r+1]=i[r];i[e]=t,this.$markDirty()}return this},g.prototype.removeChild=function(t){var e=this.$children.indexOf(t);return this.removeChildAt(e)},g.prototype.removeChildAt=function(t){if(0<=t){var e=this.$children.splice(t,1)[0];e.emit(f.REMOVED,this),this.$stage&&e.emit(f.REMOVED_FROM_STAGE,this.$stage),this.$resizeCanvas()}return this},g.prototype.removeChildrenByName=function(t){for(var e=this.$children,i=0,n=e.length;i<n;++i){if(e[i].name===t){this.removeChildAt(i);break}}return this},g.prototype.removeChildrenByTag=function(t){for(var e=this.$children,i=e.length-1;0<=i;--i){e[i].tag===t&&this.removeChildAt(i)}return this},g.prototype.removeAllChildren=function(){for(var t=0,e=this.$children;t<e.length;t++){var i=e[t];i.emit(f.REMOVED,this),this.$stage&&i.emit(f.REMOVED_FROM_STAGE)}return this.$children.length=0,this.$resizeCanvas(),this},g.prototype.removeSelf=function(){return this.$parent&&this.$parent.removeChild(this),this},g.prototype.$resizeCanvas=function(){var t=this.$width,e=this.$height,i=this.$canvas,n=this.$parent,r=this.$anchorX,o=this.$anchorY,s=g.pixelRatio;if(t&&e)i.width=t*s,i.height=e*s;else{var h=this.$getContentBounds();i.width=(t||h.right+r)*s,i.height=(e||h.bottom+o)*s,h.release()}n&&n.$resizeCanvas(),this.$dirty=!0},g.prototype.$getTransform=function(){var t=r.create();return t.translate(-this.$anchorX,-this.$anchorY),t.rotate(this.rotation*Math.PI/180).scale(this.scaleX,this.scaleY).skew(this.skewX,this.skewY),t.translate(this.x,this.y),t},g.prototype.$getChildTransform=function(t){return t.$getTransform()},g.prototype.$getChildBounds=function(t){var e=t.width,i=t.height,n=d.create(),r=this.$getChildTransform(t),o=$.create(0,0).transform(r),s=$.create(e,0).transform(r),h=$.create(0,i).transform(r),a=$.create(e,i).transform(r),u=Math.min(o.x,s.x,h.x,a.x),c=Math.max(o.x,s.x,h.x,a.x),l=Math.min(o.y,s.y,h.y,a.y),p=Math.max(o.y,s.y,h.y,a.y);return n.top=l,n.bottom=p,n.left=u,n.right=c,r.release(),o.release(),s.release(),h.release(),a.release(),n},g.prototype.$getContentBounds=function(){for(var t=this.$children,e=d.create(),i=0,n=t;i<n.length;i++){var r=n[i],o=this.$getChildBounds(r);e.top=Math.min(e.top?e.top:1/0,o.top),e.bottom=Math.max(e.bottom?e.bottom:-1/0,o.bottom),e.left=Math.min(e.left?e.left:1/0,o.left),e.right=Math.max(e.right?e.right:-1/0,o.right),o.release()}return e},g.prototype.$emitTouchEvent=function(t){if(!this.visible||!this.touchable)return!1;var e=t.type,i=this.$touches,n=t.identifier,r=this.$getTransform(),o=$.create(t.targetX,t.targetY).transform(r.invert()).subtract(this.$anchorX,this.$anchorY),s=o.x<-this.anchorX||o.x>this.width-this.anchorX||o.y<-this.anchorY||o.y>this.height-this.anchorY;if(e===c.TOUCH_START&&s)return!1;if(e===c.TOUCH_START)i[n]=!0;else{if(!i[n])return!1;e===c.TOUCH_TAP&&(i[n]=!1)}var h=this.$children;t.targetX=o.x,t.targetY=o.y;for(var a=h.length-1;0<=a;--a){if(h[a].$emitTouchEvent(t))break}return t.propagationStopped||e===c.TOUCH_TAP&&s||(t.target=t.target||this,t.currentTarget=this,t.localX=o.x,t.localY=o.y,this.emit(t.type,t)),r.release(),o.release(),!0},g.prototype.$getPattern=function(t,e){return t&&e&&"scale"!==e&&"no-repeat"!==e?this.$context.createPattern(t.element,e):null},g.prototype.$drawBackground=function(t,e,i,n,r){var o=r||this.$context,s=o.canvas,h=s.width,a=s.height,u=g.pixelRatio;t&&(o.fillStyle=t,o.fillRect(0,0,h,a)),e&&("scale"===n?o.drawImage(e.element,0,0,h,a):"no-repeat"===n?o.drawImage(e.element,0,0,e.width*u,e.height*u):i&&(1!==u&&o.scale(u,u),o.fillStyle=i,o.fillRect(0,0,h,a)))},g.prototype.$drawChild=function(t){if(!t.width||!t.height)return 0;if(!t.$dirty){var e=this.$getChildBounds(t);if(e.left>this.$width||e.right<0||e.top>this.$height||e.bottom<0)return e.release(),0;e.release()}var i=this.$context,n=t.$canvas,r=g.pixelRatio,o=this.$getChildTransform(t).scale(r),s=t.$render();return i.globalAlpha=t.alpha,o.a===r&&0===o.b&&0===o.c&&o.d===r?i.drawImage(t.$canvas,o.tx,o.ty,n.width,n.height):(i.save(),i.transform(o.a,o.b,o.c,o.d,o.tx,o.ty),i.drawImage(t.$canvas,0,0,t.width,t.height),i.restore()),o.release(),s+1},g.prototype.$render=function(){if(!this.$dirty)return 0;var t=0,e=this.$context,i=this.$canvas,n=this.$anchorX,r=this.$anchorY,o=this.$children,s=i.width,h=i.height,a=this.$backgroundColor,u=this.$backgroundImage,c=this.$backgroundPattern,l=this.$backgroundFillMode,p=g.pixelRatio;e.globalAlpha=1,e.resetTransform(),e.translate(n*p,r*p),e.clearRect(0,0,s,h),this.$drawBackground(a,u,c,l);for(var $=0,d=o;$<d.length;$++){var f=d[$];f.visible&&f.alpha&&(t+=this.$drawChild(f))}return this.$dirty=!1,t},g.prototype.on=function(t,e){return i.prototype.on.call(this,t,e),t===f.ENTER_FRAME&&this.$stage?this.$stage.ticker.registerEnterFrameCallback(this):t===f.ADDED&&this.$parent?e():t===f.ADDED_TO_STAGE&&this.$stage&&e(),this},g.prototype.off=function(t,e){return i.prototype.off.call(this,t,e),this.$stage&&t===f.ENTER_FRAME&&!this.hasEventListener(f.ENTER_FRAME)&&this.$stage.ticker.unregisterEnterFrameCallback(this),this},g.prototype.$onAdded=function(t){this.$parent=t},g.prototype.$onRemoved=function(){this.$parent=null},g.prototype.$onAddedToStage=function(t){var e=this.$children;this.hasEventListener(f.ENTER_FRAME)&&t.ticker.registerEnterFrameCallback(this),this.$stage=t;for(var i=0,n=e;i<n.length;i++){n[i].emit(f.ADDED_TO_STAGE,t)}},g.prototype.$onRemovedFromStage=function(t){var e=this.$children;this.hasEventListener(f.ENTER_FRAME)&&t.ticker.unregisterEnterFrameCallback(this),this.$stage=null;for(var i=0,n=e;i<n.length;i++){n[i].emit(f.ADDED_TO_STAGE)}},g.prototype.$markDirty=function(){this.$dirty=!0,this.$markParentDirty()},g.prototype.$markParentDirty=function(){this.$parent&&this.$parent.$markDirty()},g.pixelRatio=window.devicePixelRatio||1,g}(e),p=function(){function t(){}return t.linear=function(t,e,i,n){return i*t/n+e},t.easeInQuad=function(t,e,i,n){return i*(t/=n)*t+e},t.easeOutQuad=function(t,e,i,n){return-i*(t/=n)*(t-2)+e},t.easeInOutQuad=function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},t.easeInCubic=function(t,e,i,n){return i*(t/=n)*t*t+e},t.easeOutCubic=function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},t.easeInOutCubic=function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},t.easeInQuart=function(t,e,i,n){return i*(t/=n)*t*t*t+e},t.easeOutQuart=function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},t.easeInOutQuart=function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},t.easeInQuint=function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},t.easeOutQuint=function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},t.easeInOutQuint=function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},t.easeInSine=function(t,e,i,n){return-i*Math.cos(t/n*(Math.PI/2))+i+e},t.easeOutSine=function(t,e,i,n){return i*Math.sin(t/n*(Math.PI/2))+e},t.easeInOutSine=function(t,e,i,n){return-i/2*(Math.cos(Math.PI*t/n)-1)+e},t.easeInExpo=function(t,e,i,n){return 0===t?e:i*Math.pow(2,10*(t/n-1))+e},t.easeOutExpo=function(t,e,i,n){return t===n?e+i:i*(1-Math.pow(2,-10*t/n))+e},t.easeInOutExpo=function(t,e,i,n){return 0===t?e:t===n?e+i:(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e},t.easeInCirc=function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},t.easeOutCirc=function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},t.easeInOutCirc=function(t,e,i,n){return(t/=n/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},t.easeInElastic=function(t,e,i,n){var r=1.70158,o=0,s=i;return 0===t?e:1==(t/=n)?e+i:(o||(o=.3*n),r=s<Math.abs(i)?(s=i,o/4):o/(2*Math.PI)*Math.asin(i/s),-s*Math.pow(2,10*(t-=1))*Math.sin((t*n-r)*(2*Math.PI)/o)+e)},t.easeOutElastic=function(t,e,i,n){var r=1.70158,o=0,s=i;return 0===t?e:1==(t/=n)?e+i:(o||(o=.3*n),r=s<Math.abs(i)?(s=i,o/4):o/(2*Math.PI)*Math.asin(i/s),s*Math.pow(2,-10*t)*Math.sin((t*n-r)*(2*Math.PI)/o)+i+e)},t.easeInOutElastic=function(t,e,i,n){var r=1.70158,o=0,s=i;return 0===t?e:2==(t/=n/2)?e+i:(o||(o=n*(.3*1.5)),r=s<Math.abs(i)?(s=i,o/4):o/(2*Math.PI)*Math.asin(i/s),t<1?s*Math.pow(2,10*(t-=1))*Math.sin((t*n-r)*(2*Math.PI)/o)*-.5+e:s*Math.pow(2,-10*(t-=1))*Math.sin((t*n-r)*(2*Math.PI)/o)*.5+i+e)},t.easeInBack=function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e},t.easeOutBack=function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},t.easeInOutBack=function(t,e,i,n,r){return void 0===r&&(r=1.70158),(t/=n/2)<1?i/2*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},t.easeInBounce=function(t,e,i,n){return i-this.easeOutBounce(n-t,0,i,n)+e},t.easeOutBounce=function(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},t.easeInOutBounce=function(t,e,i,n){return t<n/2?.5*this.easeInBounce(2*t,0,i,n)+e:.5*this.easeOutBounce(2*t-n,0,i,n)+.5*i+e},t}(),l=function(n){function i(t,e){var i=n.call(this)||this;return i.loop=!1,i.$target=null,i.$paused=!0,i.$stepIndex=0,i.$stepPosition=0,i.$steps=[],i.$stepProps=[],i.$shouldSaveProps=!0,i.$target=t,i.loop=!!e&&e.loop,i.$boundOnEnterFrame=i.$onEnterFrame.bind(i),i}return o(i,n),Object.defineProperty(i.prototype,"paused",{get:function(){return this.$paused},enumerable:!0,configurable:!0}),i.prototype.set=function(t){return this.$steps.push({type:"set",props:t}),this},i.prototype.to=function(t,e,i){return this.$steps.push({type:"to",duration:e,props:t,ease:i}),this},i.prototype.wait=function(t){return this.$steps.push({type:"wait",duration:t}),this},i.prototype.call=function(t){return this.$steps.push({type:"call",callback:t}),this},i.prototype.play=function(){return this.$paused&&(this.$paused=!1,this.$target.on(f.ENTER_FRAME,this.$boundOnEnterFrame),i.$tweens.push(this)),this},i.prototype.pause=function(){if(!this.$paused){this.$paused=!0,this.$target.off(f.ENTER_FRAME,this.$boundOnEnterFrame);var t=i.$tweens.indexOf(this);0<=t&&i.$tweens.splice(t,1)}return this},i.prototype.$onEnterFrame=function(t){var e=this.loop,i=this.$steps,n=this.$steps.length,r=this.$stepIndex,o=this.$stepPosition+t,s=i[r],h=s.type,a=s.duration||0,u=s.props,c=s.ease||p.linear,l=s.callback;"set"===h?this.$setProps(u):"to"===h?this.$easeProps(r,u,o,a,c):"call"===h&&l.call(this.$target),o<a?this.$stepPosition=o:r+1<n?(this.$stepPosition=0,this.$stepIndex=r+1,this.$shouldSaveProps=!0,this.$setProps(u),this.$onEnterFrame(o-a)):e?(this.$stepIndex=0,this.$stepPosition=0,this.$shouldSaveProps=!0,this.$setProps(u),this.$onEnterFrame(o-a)):(this.$stepIndex=0,this.$stepPosition=0,this.$shouldSaveProps=!0,this.$setProps(u),this.pause())},i.prototype.$saveOriginalProps=function(t,e){var i=this.$target,n=this.$stepProps,r=n[t]=n[t]||{};for(var o in e)r[o]=i[o];this.$shouldSaveProps=!1},i.prototype.$easeProps=function(t,e,i,n,r){this.$shouldSaveProps&&this.$saveOriginalProps(t,e);var o=this.$target,s=this.$stepProps[t]||{};for(var h in n<i&&(i=n),e){var a=s[h],u=e[h]-a;o[h]=r(i,a,u,n)}},i.prototype.$setProps=function(t){var e=this.$target;for(var i in t)e[i]=t[i]},i.get=function(t,e){return new i(t,e)},i.pauseTweens=function(t){for(var e=0,i=this.$tweens;e<i.length;e++){var n=i[e];n.$target===t&&n.pause()}},i.resumeTweens=function(t){for(var e=0,i=this.$tweens;e<i.length;e++){var n=i[e];n.$target===t&&n.play()}},i.removeTweens=function(t){for(var e=this.$tweens,i=e.length-1;0<=i;--i){var n=e[i];n.$target===t&&n.pause()}},i.removeAllTweens=function(){for(var t=this.$tweens,e=t.length-1;0<=e;--e){t[e].pause()}},i.$tweens=[],i}(e),s=function(i){function t(){var t=i.call(this)||this;return t.$scrollX=0,t.$scrollY=0,t.$scrollWidth=0,t.$scrollHeight=0,t.$touchingX=0,t.$touchingY=0,t.$touchingTime=0,t.$velocitiesX=[],t.$velocitiesY=[],t.$inertiaTween=null,t.width=400,t.height=400,t.on(c.TOUCH_START,t.$onTouchStart),t.on(c.TOUCH_MOVE,t.$onTouchMove),t.on(c.TOUCH_END,t.$onTouchEnd),t}return o(t,i),Object.defineProperty(t.prototype,"scrollX",{get:function(){return this.$scrollX},set:function(t){var e=this.$getContentBounds(),i=this.$scrollWidth-this.width;this.$scrollX=Math.max(0,Math.min(t,i)),this.$markDirty(),e.release()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollY",{get:function(){return this.$scrollY},set:function(t){var e=this.$getContentBounds(),i=this.$scrollHeight-this.$height;this.$scrollY=Math.max(0,Math.min(t,i)),this.$markDirty(),e.release()},enumerable:!0,configurable:!0}),t.prototype.$getChildTransform=function(t){var e=i.prototype.$getChildTransform.call(this,t);return e.translate(-this.$scrollX,-this.$scrollY),e},t.prototype.$resizeCanvas=function(){i.prototype.$resizeCanvas.call(this);var t=this.$getContentBounds();this.$scrollWidth=this.$scrollX+t.right,this.$scrollHeight=this.$scrollY+t.bottom},t.prototype.$onTouchStart=function(t){this.$touchingX=t.localX,this.$touchingY=t.localY,this.$velocitiesX.length=0,this.$velocitiesY.length=0,this.$inertiaTween&&(this.$inertiaTween.pause(),this.$inertiaTween=null)},t.prototype.$onTouchMove=function(t){var e=Date.now(),i=e-this.$touchingTime,n=this.$velocitiesX,r=this.$velocitiesY,o=t.localX-this.$touchingX,s=t.localY-this.$touchingY;n.push(o/i),r.push(s/i),5<n.length&&(n.shift(),r.shift()),this.scrollX-=o,this.scrollY-=s,this.$touchingX=t.localX,this.$touchingY=t.localY,this.$touchingTime=e},t.prototype.$onTouchEnd=function(){for(var t=this.$scrollX,e=this.$scrollY,i=0,n=0,r=this.$velocitiesX,o=this.$velocitiesY,s=r.length,h=0;h<s;++h)i+=r[h],n+=o[h];var a=i/s,u=n/s;if(.05<a||.05<u){var c=1e3*Math.max(Math.abs(a),Math.abs(u),1);this.$inertiaTween=l.get(this).to({scrollX:t-a*(Math.abs(a)+1)*200,scrollY:e-u*(Math.abs(u)+1)*200},c,p.easeOutQuart).play()}},t}(w),h=function(h){function t(t,e,i){var n=h.call(this)||this;return t&&(n.$width=e||t.width,n.$height=i||t.height,n.$boundOnImageLoad=n.$onImageLoad.bind(n),n.image=t),n}return o(t,h),Object.defineProperty(t.prototype,"image",{get:function(){return this.$image},set:function(t){this.$image=t,this.$width=this.$width||t.width,this.$height=this.$height||t.height,this.$resizeCanvas(),this.$width||this.$height||t.on("load",this.$boundOnImageLoad)},enumerable:!0,configurable:!0}),t.prototype.$onImageLoad=function(){var t=this.$image;this.$width=this.$width||t.width,this.$height=this.$height||t.height,this.$resizeCanvas(),t.off("load",this.$boundOnImageLoad)},t.prototype.$render=function(){if(this.$dirty){var t=this.$image,e=this.$context,i=this.$canvas,n=this.$anchorX,r=this.$anchorY,o=h.prototype.$render.call(this),s=w.pixelRatio;return e.drawImage(t.element,-n*s,-r*s,i.width,i.height),o}},t}(w),a=function(b){function a(t,e){void 0===e&&(e={});var i=b.call(this)||this;return i.$text="",i.$color="black",i.$fontSize=a.defaultFontSize,i.$fontStyle="normal",i.$fontWeight="normal",i.$textAlign="left",i.$verticalAlign="top",i.$lineHeight=1.2,i.$strokeSize=0,i.$strokeColor=null,i.$fontFamily="Helvetica",i.$multiline=!1,i.$breakWord=!1,i.$autoFitSize=!1,i.$minFontSize=0,i.$explicitSize=0,i.$lines=[],i.$text=t||i.$text,i.$color=e.color||i.$color,i.$fontSize=e.fontSize||i.$fontSize,i.$fontStyle=e.fontStyle||i.$fontStyle,i.$fontWeight=e.fontWeight||i.$fontWeight,i.$textAlign=e.textAlign||i.$textAlign,i.$verticalAlign=e.verticalAlign||i.$verticalAlign,i.$lineHeight=e.lineHeight||i.$lineHeight,i.$strokeSize=e.strokeSize||i.$strokeSize,i.$strokeColor=e.strokeColor||i.$strokeColor,i.$fontFamily=e.fontFamily||i.$fontFamily,i.$multiline=e.multiline||i.$multiline,i.$breakWord=e.breakWord||i.$breakWord,i.$resizeCanvas(),i}return o(a,b),Object.defineProperty(a.prototype,"text",{get:function(){return this.$text},set:function(t){this.$text=t,this.$resizeCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"color",{get:function(){return this.$color},set:function(t){this.$color=t,this.$markDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fontSize",{get:function(){return this.$fontSize},set:function(t){this.$fontSize=t,this.$resizeCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fontStyle",{get:function(){return this.$fontStyle},set:function(t){this.$fontStyle=t,this.$resizeCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fontWeight",{get:function(){return this.$fontWeight},set:function(t){this.$fontWeight=t,this.$resizeCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"textAlign",{get:function(){return this.$textAlign},set:function(t){this.$textAlign=t,this.$markDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"verticalAlign",{get:function(){return this.$verticalAlign},set:function(t){this.$verticalAlign=t,this.$markDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"lineHeight",{get:function(){return this.$lineHeight},set:function(t){this.$lineHeight=t,this.$resizeCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"strokeSize",{get:function(){return this.$strokeSize},set:function(t){this.$strokeSize=t,this.$markDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"strokeColor",{get:function(){return this.$strokeColor},set:function(t){this.$strokeColor=t,this.$markDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fontFamily",{get:function(){return this.$fontFamily},set:function(t){this.$fontFamily=t,this.$resizeCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"multiline",{get:function(){return this.$multiline},set:function(t){this.$multiline=t,this.$resizeCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"breakWord",{get:function(){return this.$breakWord},set:function(t){this.$breakWord=t,this.$resizeCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"autoFitSize",{get:function(){return this.$autoFitSize},set:function(t){this.$autoFitSize=t,this.$resizeCanvas()},enumerable:!0,configurable:!0}),a.prototype.$updateContext=function(){var t=this.$context,e=this.$fontStyle,i=this.$fontWeight,n=w.pixelRatio,r=(this.$explicitSize||this.$fontSize)*n+"px";t.font=e+" "+i+" "+r+" "+this.fontFamily,t.textAlign=this.textAlign,t.textBaseline="top",t.fillStyle=this.color,t.lineWidth=this.strokeSize*n,t.strokeStyle=this.strokeColor},a.prototype.$divideUnits=function(){var t,e=this.$text,i=this.$breakWord,n=a.wordRe,r=a.boundaryRe;if(i)t=e.split("");else{t=[];for(var o=0,s=e.split(r);o<s.length;o++){var h=s[o];n.test(h)?t.push(h):t=t.concat(h.split(""))}}return t},a.prototype.$divideLines=function(){var t=this.$text;if(this.$multiline)if(this.$width){var e="",i=this.$context,n=this.$lines=[],r=this.$divideUnits(),o=this.$width*w.pixelRatio;this.$updateContext();for(var s=0,h=r;s<h.length;s++){var a=h[s];if("\n"!==a)i.measureText(e+a).width<=o?e+=a:(e&&n.push(e),e=a);else n.push(e),e=""}n.push(e)}else this.$lines=t.split("\n");else this.$lines=[t]},a.prototype.$resizeCanvas=function(){var t=this.$width,e=this.$height;if(this.$divideLines(),this.$autoFitSize&&(t||e)){var i=this.$minFontSize||1;for(this.$explicitSize=this.$fontSize;this.$explicitSize>i;){var n=this.$getContentBounds();if(!(t&&n.width>t||e&&n.height>e))break;--this.$explicitSize,n.release()}}b.prototype.$resizeCanvas.call(this)},a.prototype.$getContentBounds=function(){var t=this.$context,e=b.prototype.$getContentBounds.call(this),i=this.$lines,n=this.$lineHeight,r=w.pixelRatio,o=this.$explicitSize||this.$fontSize;this.$updateContext();for(var s=0,h=i;s<h.length;s++){var a=h[s];e.width=Math.max(e.width,t.measureText(a).width/r)}return e.height=Math.max(e.height,o*n*i.length),e},a.prototype.$render=function(){if(!this.$dirty)return 0;var t=0,e=0,i=this.width,n=this.height,r=this.anchorX,o=this.anchorY,s=this.$context,h=this.$lines,a=this.$color,u=this.$textAlign,c=this.$verticalAlign,l=this.$lineHeight,p=this.$strokeSize,$=this.$strokeColor,d=w.pixelRatio,f=this.$explicitSize||this.$fontSize,g=b.prototype.$render.call(this);this.$updateContext(),t="center"===u?i*d/2-r*d:"right"===u?i*d-r*d:-r*d,e="middle"===c?(n-f*l*h.length)*d/2-o*d:"bottom"===c?(n-f*l*h.length)*d-o*d:-o*d;for(var y=0,m=h;y<m.length;y++){var v=m[y];a&&s.fillText(v,t,e),p&&$&&s.strokeText(v,t,e),e+=f*l*d}return g},a.defaultFontSize=30,a.wordRe=/\w+/,a.boundaryRe=/\b/,a}(w),u=function(i){function t(t){var e=i.call(this)||this;return e.$ticker=t,e.$boundOnLoad=e.$onLoad.bind(e),e.$boundOnError=e.$onError.bind(e),e}return o(t,i),Object.defineProperty(t.prototype,"element",{get:function(){return this.$element},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{set:function(t){this.$element.src=t},enumerable:!0,configurable:!0}),t.prototype.$onLoad=function(){this.emit("load"),this.$element.removeEventListener(f.LOAD,this.$boundOnLoad)},t.prototype.$onError=function(t){this.emit("error",t),this.$element.removeEventListener(f.ERROR,this.$boundOnError)},t}(e),g=function(n){function t(t){var e=n.call(this,t)||this,i=document.createElement("img");return i.crossOrigin="*",i.addEventListener("load",e.$boundOnLoad),i.addEventListener("error",e.$boundOnError),e.$element=i,e}return o(t,n),Object.defineProperty(t.prototype,"element",{get:function(){return this.$element},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.$element.width},set:function(t){this.$element.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.$element.height},set:function(t){this.$element.height=t},enumerable:!0,configurable:!0}),t}(u),y=function(n){function t(t){var e=n.call(this,t)||this;e.$loops=1,e.$startTime=0,e.$paused=!1;var i=document.createElement("audio");return i.crossOrigin="*",i.addEventListener("canplaythrough",e.$boundOnLoad),i.addEventListener("error",e.$boundOnError),i.addEventListener("ended",e.$onEnded.bind(e)),e.$element=i,e.$ticker=t,e.$boundOnTouch=e.$onTouch.bind(e),t.on(f.TICKER_PAUSE,e.$onTickerPause.bind(e)),t.on(f.TICKER_RESUME,e.$onTickerResume.bind(e)),e}return o(t,n),Object.defineProperty(t.prototype,"element",{get:function(){return this.$element},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{set:function(t){this.$paused=!0,this.$element.src=t,this.$element.load(),0===t.indexOf("data:")&&this.$ticker.setTimeout(this.$boundOnLoad)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this.$element.volume},set:function(t){this.$element.volume=t},enumerable:!0,configurable:!0}),t.prototype.$checkOnTouch=function(){document.addEventListener("click",this.$boundOnTouch),document.addEventListener("touchend",this.$boundOnTouch)},t.prototype.$checkStatus=function(){this.$element.play().catch(),this.$paused&&this.$element.pause()},t.prototype.$onTouch=function(){this.$checkStatus(),document.removeEventListener("click",this.$boundOnTouch),document.removeEventListener("touchend",this.$boundOnTouch)},t.prototype.$onEnded=function(){1===this.$loops?(this.stop(),this.emit(f.SOUND_COMPLETE)):0===this.$loops?this.play(this.$startTime,0):this.play(this.$startTime,this.$loops-1)},t.prototype.$onTickerPause=function(){this.$paused||this.$element.pause()},t.prototype.$onTickerResume=function(){this.$paused||this.$checkStatus()},t.prototype.play=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=1),this.$loops=e,this.$startTime=t,this.$element.currentTime=t,this.$paused=!1,this.$checkStatus(),this},t.prototype.stop=function(){return this.$paused=!0,this.$element.pause(),this},t.prototype.$onLoad=function(){n.prototype.$onLoad.call(this),this.$element.play().then(this.$checkStatus.bind(this)).catch(this.$checkOnTouch.bind(this))},t}(u),m=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t}(y),v=function(r){function d(t,e,i){var n=r.call(this)||this;return n.$errorCount=0,n.$loadedCount=0,n.$loadingCount=0,n.$ticker=t,n.threads=i&&i.threads||2,n.timeout=i&&i.timeout||1e4,n.retryTimes=i&&i.retryTimes||3,n.$list=e.concat(),n.$total=e.length,n.$resources={},n.$checkPendingTasks(),n}return o(d,r),Object.defineProperty(d.prototype,"total",{get:function(){return this.$total},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"errorCount",{get:function(){return this.$errorCount},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"loadedCount",{get:function(){return this.$loadedCount},enumerable:!0,configurable:!0}),d.prototype.$checkPendingTasks=function(){this.$loadingCount<this.threads&&0<this.$list.length&&(++this.$loadingCount,this.$load(this.$list.shift(),1))},d.prototype.$load=function(i,n){var r,o,s=this,h=i.name,t=i.type,e=i.url,a=this.$total,u=this.$ticker,c=this.$resources,l=this.retryTimes,p=function(){var t=s.$errorCount,e=++s.$loadedCount;--s.$loadingCount,c[h]=o,u.clearTimeout(r),o.off(f.LOAD,p),o.off(f.ERROR,$),s.emit(f.PROGRESS,(e+t)/a),e+t===a?s.emit(f.COMPLETE):s.$checkPendingTasks()},$=function(){if(n<l)s.$load(i,n+1);else{--s.$loadingCount;var t=s.$loadedCount,e=++s.$errorCount;c[h]=o,s.emit(f.PROGRESS,(t+e)/a),t+e===a?s.emit(f.COMPLETE):s.$checkPendingTasks()}u.clearTimeout(r),o.off(f.LOAD,p),o.off(f.ERROR,$)};if(t===d.TYPE_IMAGE)(o=new g(u)).on(f.LOAD,p),o.on(f.ERROR,$),o.url=e;else if(t===d.TYPE_SOUND)(o=new y(u)).on(f.LOAD,p),o.on(f.ERROR,$),o.url=e;else{if(t!==d.TYPE_SOUND_EFFECT)throw new Error("Unsupported resource type: "+t);(o=new m(u)).on(f.LOAD,p),o.on(f.ERROR,$),o.url=e}r=u.setTimeout($,this.timeout)},d.prototype.has=function(t){return!!this.$resources[t]},d.prototype.get=function(t){var e=this.$resources[t];if(!e)throw new Error("Resource not exists");return e},d.TYPE_IMAGE="image",d.TYPE_SOUND="sound",d.TYPE_SOUND_EFFECT="soundEffect",d}(e),b=function(l){function p(t){var e=l.call(this)||this;return e.$viewportBackgroundFillMode="scale",e.$scaleMode=p.SHOW_ALL,e.$ticker=new i(e),e.$viewportCanvas=t||document.createElement("canvas"),e.$viewportContext=e.$viewportCanvas.getContext("2d"),e.$boundResizeViewportCanvas=e.$resizeViewportCanvas.bind(e),e.$initEvents(),e.width=640,e.height=1136,e.viewportWidth=0,e.viewportHeight=0,t||(e.$viewportCanvas.style.top="0",e.$viewportCanvas.style.left="0",e.$viewportCanvas.style.position="fixed",document.body.appendChild(e.$viewportCanvas)),e}return o(p,l),p.prototype.$initEvents=function(){var t,e=this,i=this.$ticker;this.$addTouchEventListeners(),this.on(f.ENTER_FRAME,this.$render),i.setTimeout(function(){e.emit(f.ADDED_TO_STAGE,e)}),window.addEventListener("resize",function(){i.clearTimeout(t),t=i.setTimeout(e.$boundResizeViewportCanvas,100)})},Object.defineProperty(p.prototype,"x",{get:function(){return 0},set:function(t){this.$x=0},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"y",{get:function(){return 0},set:function(t){this.$y=0},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"scaleMode",{get:function(){return this.$scaleMode},set:function(t){this.scaleMode!==t&&(this.$scaleMode=t,this.$resizeCanvas())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"viewportWidth",{get:function(){return this.$viewportWidth?this.$viewportWidth:this.$viewportCanvas.width/w.pixelRatio},set:function(t){this.$viewportWidth!==t&&(this.$viewportWidth=t,this.$resizeViewportCanvas())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"viewportHeight",{get:function(){return this.$viewportHeight?this.$viewportHeight:this.$viewportCanvas.height/w.pixelRatio},set:function(t){this.$viewportHeight!==t&&(this.$viewportHeight=t,this.$resizeViewportCanvas())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"viewportBackgroundColor",{get:function(){return this.$viewportBackgroundColor},set:function(t){this.$viewportBackgroundColor!==t&&(this.$viewportBackgroundColor=t,this.$markDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"viewportBackgroundImage",{get:function(){return this.$viewportBackgroundImage},set:function(t){this.$viewportBackgroundImage!==t&&(this.$viewportBackgroundImage=t,this.$viewportBackgroundPattern=this.$getPattern(this.$viewportBackgroundImage,this.$viewportBackgroundFillMode),this.$markDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"viewportBackgroundFillMode",{get:function(){return this.$viewportBackgroundFillMode},set:function(t){this.$viewportBackgroundFillMode!==t&&(this.$viewportBackgroundFillMode=t||"scale",this.$viewportBackgroundPattern=this.$getPattern(this.$viewportBackgroundImage,this.$viewportBackgroundFillMode),this.$markDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"drawCalls",{get:function(){return this.$drawCalls},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"fps",{get:function(){return this.$ticker.fps},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"ticker",{get:function(){return this.$ticker},enumerable:!0,configurable:!0}),p.prototype.createResourceManager=function(t,e){return new v(this.$ticker,t,e)},p.prototype.$addTouchEventListeners=function(){var e=this,t=this.$viewportCanvas;if(void 0!==t.ontouchstart)t.addEventListener("touchstart",function(t){e.$dispatchTouches(c.TOUCH_START,t),t.preventDefault()}),t.addEventListener("touchmove",function(t){e.$dispatchTouches(c.TOUCH_MOVE,t),t.preventDefault()},{passive:!1}),t.addEventListener("touchend",function(t){e.$dispatchTouches(c.TOUCH_END,t),e.$dispatchTouches(c.TOUCH_TAP,t)}),t.addEventListener("touchcancel",function(t){e.$dispatchTouches(c.TOUCH_CANCEL,t)});else{var i=!1;t.addEventListener("mousedown",function(t){e.$dispatchTouchEvent(c.TOUCH_START,t),i=!0}),t.addEventListener("mousemove",function(t){i&&e.$dispatchTouchEvent(c.TOUCH_MOVE,t)}),t.addEventListener("mouseup",function(t){e.$dispatchTouchEvent(c.TOUCH_END,t),i=!1}),t.addEventListener("click",function(t){e.$dispatchTouchEvent(c.TOUCH_TAP,t)}),window.addEventListener("mouseout",function(t){e.$dispatchTouchEvent(c.TOUCH_CANCEL,t)})}},p.prototype.$dispatchTouches=function(t,e){for(var i=e.changedTouches,n=0,r=i.length;n<r;++n)this.$dispatchTouchEvent(t,i[n])},p.prototype.$dispatchTouchEvent=function(t,e){if(!this.$ticker.paused){var i=c.create(t),n=this.$canvas.width,r=this.$canvas.height,o=this.$renderBounds,s=w.pixelRatio,h=this.$viewportCanvas.getBoundingClientRect(),a=(e.pageX-h.left-o.x/s)*n/o.width-this.$anchorX,u=(e.pageY-h.top-o.y/s)*r/o.height-this.$anchorY;i.targetX=i.stageX=a,i.targetY=i.stageY=u,i.identifier=e instanceof Touch?e.identifier:0,this.$emitTouchEvent(i),i.release()}},p.prototype.$calculateRenderBounds=function(){var t=0,e=0,i=this.$canvas,n=i.width,r=i.height,o=this.scaleMode,s=n/r,h=this.$viewportCanvas,a=h.width,u=h.height,c=a/u,l=this.$renderBounds||d.create();o===p.NO_SCALE||(o===p.NO_BORDER?(s<c?r=(n=a)/s:n=(r=u)*s,t=(a-n)/2,e=(u-r)/2):o===p.SHOW_ALL?c<s?r=(n=a)/s:n=(r=u)*s:o===p.EXACT_FIT?(n=a,r=u):o===p.FIXED_WIDTH?r=(n=a)/s:o===p.FIXED_HEIGHT?n=(r=u)*s:o===p.FIXED_WIDE?u<a?r=(n=a)/s:n=(r=u)*s:o===p.FIXED_NARROW&&(a<u?r=(n=a)/s:n=(r=u)*s)),n<a&&(t=(a-n)/2),r<u&&(e=(u-r)/2),l.x=t,l.y=e,l.width=n,l.height=r,this.$renderBounds=l},p.prototype.$resizeCanvas=function(){l.prototype.$resizeCanvas.call(this),this.$calculateRenderBounds()},p.prototype.$resizeViewportCanvas=function(){var t=this.$viewportWidth||window.innerWidth,e=this.$viewportHeight||window.innerHeight;this.$viewportCanvas.width=t*w.pixelRatio,this.$viewportCanvas.style.width=t+"px",this.$viewportCanvas.height=e*w.pixelRatio,this.$viewportCanvas.style.height=e+"px",this.$calculateRenderBounds(),this.$markDirty(),this.emit(f.VIEWPORT_RESIZE)},p.prototype.$render=function(){if(!this.$dirty)return 0;var t=l.prototype.$render.call(this),e=this.$canvas,i=this.$viewportContext,n=this.$renderBounds,r=this.$viewportCanvas,o=r.width,s=r.height,h=this.$viewportBackgroundColor,a=this.$viewportBackgroundImage,u=this.$viewportBackgroundPattern,c=this.$viewportBackgroundFillMode;return i.clearRect(0,0,o,s),this.$drawBackground(h,a,u,c,i),i.drawImage(e,n.x,n.y,n.width,n.height),this.$drawCalls=++t,t},p.NO_SCALE="noScale",p.NO_BORDER="noBorder",p.SHOW_ALL="showAll",p.EXACT_FIT="exactFit",p.FIXED_WIDE="fixedWide",p.FIXED_NARROW="fixedNarrow",p.FIXED_WIDTH="fixedWidth",p.FIXED_HEIGHT="fixedHeight",p}(w);return t.Ticker=i,t.Layer=w,t.ScrollView=s,t.ImageView=h,t.TextView=a,t.Stage=b,t.Event=f,t.TouchEvent=c,t.EventEmitter=e,t.Matrix=r,t.Vector=$,t.Rectangle=d,t.Media=u,t.Image=g,t.Sound=y,t.SoundEffect=m,t.Ease=p,t.Tween=l,t.ResourceManager=v,t}({});
